<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NephroCare Pro â€“ Patient Entry</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <form id="visit-form">
    <div class="max-w-6xl mx-auto p-6" x-data="{ tab: 'labs' }">
      <h1 class="text-3xl font-bold text-center mb-6 text-green-700">NephroCare Pro â€“ Patient Entry</h1>

      <!-- Tab Buttons -->
      <div class="flex space-x-4 border-b pb-2 mb-6">
        <template x-for="name in ['info', 'vitals', 'symptoms', 'labs', 'history', 'imaging', 'advanced']" :key="name">
          <button type="button" @click="tab = name" class="px-4 py-2 rounded-t font-semibold" :class="tab === name ? 'bg-green-600 text-white' : 'bg-gray-200 text-gray-700'" x-text="name.charAt(0).toUpperCase() + name.slice(1)"></button>
        </template>
      </div>

      <!-- Tab Panels (unchanged) -->
      <!-- âœ… KEEP your entire existing tab structure for info, vitals, symptoms, labs, etc. -->

      <!-- Output & Actions -->
      <div class="mt-6">
        <button id="generate-diagnosis" type="button" class="px-4 py-2 bg-green-600 text-white rounded">ğŸ§  Generate Diagnosis</button>
        <div id="missing-fields" class="text-red-600 font-medium mt-4"></div>

        <!-- Diagnosis Choice -->
        <div id="diagnosis-choice" class="my-4 space-y-2"></div>

        <!-- Doctor + Patient Diagnoses -->
        <div class="mt-4">
          <h2 class="text-lg font-semibold text-green-700">ğŸ‘¨â€âš•ï¸ Doctorâ€™s Diagnosis</h2>
          <textarea id="doctor-diagnosis" class="w-full border p-2 rounded h-32" readonly></textarea>
        </div>
        <div class="mt-4">
          <h2 class="text-lg font-semibold text-blue-700">ğŸ‘¥ Patient-Friendly Explanation</h2>
          <textarea id="patient-diagnosis" class="w-full border p-2 rounded h-32" readonly></textarea>
        </div>

        <!-- Prescription Builder -->
        <div class="mt-4">
          <h2 class="text-lg font-semibold text-purple-700">ğŸ’Š Suggested Medicines</h2>
          <div id="medicine-output" class="bg-gray-100 p-4 rounded"></div>

          <div id="prescription-builder" class="mt-6">
            <h2 class="text-xl font-semibold mb-2">ğŸ’Š Doctor's Prescription</h2>

            <!-- Suggested medicine checkboxes will go here -->
            <div id="suggested-meds" class="mb-3">
              <h3 class="text-sm font-medium text-gray-700">Suggested Medicines:</h3>
            </div>

            <!-- Add Manual Medicine -->
            <div class="mb-3">
              <label class="block text-sm font-medium text-gray-700">Add More Medicines:</label>
              <input list="medicine-list" id="manual-medicine" placeholder="e.g. Telmisartan 40 or 40 mg" class="w-full border rounded p-2 mt-1" />
              <datalist id="medicine-list"></datalist>
              <button type="button" id="add-manual-medicine" class="mt-2 px-3 py-1 bg-blue-600 text-white rounded">â• Add Medicine</button>
            </div>

            <!-- Autofill Dose + Instructions -->
            <div class="grid grid-cols-2 gap-2 mt-2">
              <input type="text" id="dose-field" placeholder="Dose e.g. 40mg OD" class="w-full border rounded p-2" />
              <input type="text" id="instruction-field" placeholder="Instructions e.g. After food" class="w-full border rounded p-2" />
            </div>

            <!-- Add Manual Test -->
            <div class="mb-3 mt-4">
              <label class="block text-sm font-medium text-gray-700">Add Recommended Tests:</label>
              <input list="test-list" id="manual-test" placeholder="e.g. Serum Ferritin, Ultrasound KUB" class="w-full border rounded p-2 mt-1" />
              <datalist id="test-list"></datalist>
              <button type="button" id="add-manual-test" class="mt-2 px-3 py-1 bg-indigo-600 text-white rounded">â• Add Test</button>
            </div>

            <!-- Final Output -->
            <div class="mt-4">
              <h3 class="text-sm font-medium text-gray-700">Final Prescription:</h3>
              <div id="final-medicines" class="bg-gray-50 p-2 rounded text-sm whitespace-pre-wrap"></div>
              <div id="final-tests" class="bg-gray-50 p-2 rounded text-sm whitespace-pre-wrap mt-2"></div>
            </div>
          </div>
        </div>

        <!-- Print Button -->
        <button id="print-button" type="button" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded">ğŸ–¨ï¸ Print Prescription</button>
      </div>
    </div>

    <!-- Hidden Printable Prescription -->
    <div id="printable-prescription" class="hidden p-4 text-sm">
      <h2 class="text-xl font-bold mb-2">ğŸ“ Prescription Summary</h2>
      <p><strong>Date:</strong> <span id="print-date"></span></p>
      <p><strong>Patient:</strong> <span id="print-patient-name"></span>, <span id="print-patient-age"></span> y/o</p>
      <p><strong>Location:</strong> <span id="print-patient-location"></span></p>

      <h3 class="mt-4 text-lg font-semibold">Doctor's Diagnosis</h3>
      <div id="print-doctor-diagnosis" class="whitespace-pre-wrap"></div>

      <h3 class="mt-4 text-lg font-semibold">Patient Explanation</h3>
      <div id="print-patient-diagnosis" class="whitespace-pre-wrap"></div>

      <h3 class="mt-4 text-lg font-semibold">Medicines</h3>
      <div id="print-medicine-output" class="whitespace-pre-wrap"></div>

      <h3 class="mt-4 text-lg font-semibold">Recommended Tests</h3>
      <div id="print-test-output" class="whitespace-pre-wrap"></div>
    </div>
  </form>

  <!-- JS Scripts -->
  <script type="module" src="js/app.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="./html2pdf.js"></script>
</body>
</html>
